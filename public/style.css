:root {
  --bg: #fff;
  --text: #111;
  --border: #ccc;
  --hour-h: 40px;
  --today-accent: #f1c233;
  --today-bg: rgba(241,194,51,.18);

  --school: #1e88e5;
  --activities: #e53935;
  --personal: #43a047;

  --btn-primary: #1e88e5;
  --btn-primary-hover: #176dc0;
  --btn-danger: #e53935;
  --btn-danger-hover: #c62828;
  --btn-neutral: #e9ecef;
}

[data-theme="dark"] {
  --bg: #1b1b1b;
  --text: #eee;
  --border: #333;
  --today-accent: #f1c233;
  --today-bg: rgba(241,194,51,.18);
  --btn-neutral: #2a2a2a;
}

@media (prefers-color-scheme: dark) { :root { color-scheme: dark; } }

/* ===== General layout ===== */
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
}

header {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 12px;
  padding: 12px 18px;
  border-bottom: 1px solid var(--border);
  background: var(--bg);
  position: sticky;
  top: 0;
  z-index: 20000;   /* ensure header stays above dragged events */
}
header h1 { margin: 0; font-size: 18px; text-align: center; }
.header-spacer { min-width: 1px; }

/* Uniform header nav buttons */
#controls { display: flex; gap: 8px; align-items: center; }
#controls .nav-btn {
  appearance: none;
  border: 1px solid var(--border);
  background: var(--btn-neutral);
  color: var(--text);
  font: inherit;
  padding: 8px 14px;
  border-radius: 10px;
  line-height: 1;
  height: 36px;
  min-width: 90px;
  cursor: pointer;
  transition: background .15s, border-color .15s, transform .02s;
}
#controls .nav-btn:hover { border-color: #aaa; }
#controls .nav-btn:active { transform: translateY(1px); }

/* Legend above calendar */
.legend-bar {
  display: flex;
  gap: 16px;
  align-items: center;
  padding: 6px 18px;
  border-bottom: 1px solid var(--border);
  background: var(--bg);
  font-size: 12px;
  position: sticky;
  top: 60px;        /* sits under header; adjust if header height changes */
  z-index: 15000;   /* above events */
}
.legend-item { display: flex; align-items: center; gap: 6px; }
.legend-color { width: 12px; height: 12px; border-radius: 3px; }
.legend-school { background: var(--school); }
.legend-activities { background: var(--activities); }
.legend-personal { background: var(--personal); }

/* ===== Layout frame ===== */
main {
  display: grid;
  grid-template-columns: 70px 1fr;
  height: auto;
}

/* Time column with top spacer to align with date row */
.time-col {
  border-right: 1px solid var(--border);
  background: var(--bg);
  display: grid;
  grid-template-rows: 32px auto;
}
.time-head-spacer {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  color: #777;
  border-bottom: 1px solid var(--border);
  user-select: none;
  position: sticky;
  top: calc(60px + 28px); /* below header+legend-ish */
  background: var(--bg);
  z-index: 14000;
}
#time-body .tick {
  border-bottom: 1px solid var(--border);
  height: var(--hour-h);
  box-sizing: border-box;
  color: #777;
  padding-top: 2px;
  text-align: right;
  padding-right: 6px;
  font-size: 11px;
  user-select: none;
  cursor: pointer;
}

/* Days area */
.days {
  display: grid;
  grid-template-rows: 32px auto;
  overflow: visible;
}

/* Dates row directly above columns — sticky */
.days-head {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  align-items: center;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  padding: 0;
  margin: 0;
  position: sticky;
  top: calc(60px + 28px); /* under header + aligns with time head spacer */
  z-index: 15000;         /* stay above events while scrolling */
}
.day-name {
  text-align: center;
  font-weight: 600;
  font-size: 13px;
  line-height: 32px;
  border-bottom: 3px solid transparent;
  background: var(--bg);
}
.day-name.is-today {
  color: var(--today-accent);
  border-bottom-color: var(--today-accent);
  background: var(--today-bg);
}

/* 24h grid */
.days-wrap {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  position: relative;
}
.day-body {
  position: relative;
  border-right: 1px solid var(--border);
  min-height: calc(24 * var(--hour-h));
  background: var(--bg);
  overflow: hidden;
}
.day-body:last-child { border-right: none; }

/* Hour lines */
.hour-grid {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background-image: repeating-linear-gradient(
    to bottom,
    var(--border),
    var(--border) 0.5px,
    transparent 0.5px,
    transparent var(--hour-h)
  );
}

/* ===== Events ===== */
.event-block {
  position: absolute;
  border-radius: 4px;
  color: #fff;
  box-sizing: border-box;
  padding: 2px 3px;
  cursor: grab;
  user-select: none;
  touch-action: none;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  font-size: 10px;
  z-index: 100;            /* base — header/legend are higher */
}
.event-block .title {
  font-weight: 500;
  font-size: 10px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.event-block .time {
  font-size: 9px;
  opacity: 0.9;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.event-block:hover { box-shadow: 0 0 3px rgba(0,0,0,0.4); }

/* Categories */
.category-school { background: var(--school); }
.category-activities { background: var(--activities); }
.category-personal { background: var(--personal); }

/* Resize handles */
.resize-top, .resize-bottom {
  position: absolute; left: 0; right: 0; height: 5px; background: transparent; cursor: ns-resize;
}
.resize-top { top: 0; }
.resize-bottom { bottom: 0; }

/* Compact thresholds */
.event-block.compact .title { font-size: 9px; }
.event-block.compact .time  { font-size: 8px; }
.event-block.tiny .title    { font-size: 8px; }
.event-block.tiny .time     { display: none; }
.event-block.very-short .title { font-size: 7px; line-height: 1; }
.event-block.very-short .time  { display: none; }
.event-block.micro .content { display: none; }

/* ===== Modal ===== */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  grid-template-rows: 1fr auto;
  align-items: center;
  justify-items: center;
  z-index: 30000;        /* above everything */
}
.modal-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 30000;
  backdrop-filter: blur(1.5px);
}
.modal-dialog {
  background: var(--bg);
  color: var(--text);
  border-radius: 12px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.35);
  padding: 22px 28px 24px;
  min-width: 440px;
  max-width: 560px;
  z-index: 30001;
  position: relative;
}
.modal-accent {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 5px;
  background: var(--school);
  border-radius: 12px 12px 0 0;
}
.modal-dialog h2 { margin: 10px 0 12px; }
.modal-dialog input,
.modal-dialog select {
  width: 100%;
  padding: 8px 10px;
  margin: 6px 0 12px;
  box-sizing: border-box;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--bg);
  color: var(--text);
}
.modal-dialog .row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* Category pills */
.cat-group {
  display: flex;
  gap: 10px;
  margin: 6px 0 14px;
  flex-wrap: wrap;
}
.cat-pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--border);
  cursor: pointer;
  user-select: none;
  font-size: 13px;
  background: transparent;
  color: var(--text);
  transition: background .15s, color .15s, border-color .15s;
}
.cat-pill input { display: none; }
.cat-school      { border-color: var(--school);      color: var(--school); }
.cat-activities  { border-color: var(--activities);  color: var(--activities); }
.cat-personal    { border-color: var(--personal);    color: var(--personal); }
.cat-school:has(input:checked)     { background: var(--school);     color: #fff; border-color: var(--school); }
.cat-activities:has(input:checked) { background: var(--activities); color: #fff; border-color: var(--activities); }
.cat-personal:has(input:checked)   { background: var(--personal);   color: #fff; border-color: var(--personal); }

/* Buttons */
.actions { margin-top: 6px; display: flex; gap: 10px; }
.btn {
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--btn-neutral);
  color: var(--text);
  cursor: pointer;
}
.btn-primary {
  background: var(--btn-primary);
  color: #fff;
  border-color: var(--btn-primary);
}
.btn-primary:hover { background: var(--btn-primary-hover); border-color: var(--btn-primary-hover); }
.btn-danger {
  background: var(--btn-danger);
  color: #fff;
  border-color: var(--btn-danger);
}
.btn-danger:hover { background: var(--btn-danger-hover); border-color: var(--btn-danger-hover); }

/* Freeze background while modal open */
body.modal-open { overflow: hidden; }
body.modal-open .event-block { pointer-events: none; }

/* Scrollbar */
.days-wrap::-webkit-scrollbar { width: 8px; }
.days-wrap::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

/* ===== Custom Confirm ===== */
.confirm.hidden { display: none; }
.confirm {
  position: fixed; inset: 0; z-index: 31000;
  display: grid; place-items: center;
}
.confirm-backdrop {
  position: absolute; inset: 0; background: rgba(0,0,0,.45);
  backdrop-filter: blur(1.5px);
}
.confirm-dialog {
  position: relative;
  background: var(--bg);
  color: var(--text);
  min-width: 360px; max-width: 520px;
  border-radius: 12px;
  box-shadow: 0 16px 36px rgba(0,0,0,.35);
  padding: 18px 20px 16px;
  z-index: 31001;
}
.confirm-accent {
  position: absolute; top: 0; left: 0; right: 0; height: 5px;
  background: var(--today-accent);
  border-radius: 12px 12px 0 0;
}
.confirm-title { margin: 6px 0 8px; font-size: 16px; }
.confirm-message { margin: 0 0 14px; line-height: 1.4; }
.confirm-actions {
  display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;
}
.confirm-actions .btn { min-width: 110px; }

