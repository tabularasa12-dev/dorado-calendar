<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dorado Calendar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-2xl mx-auto bg-white shadow-md rounded-lg p-6">
    <h1 class="text-2xl font-bold mb-4">ðŸ“… Dorado Calendar</h1>

    <!-- Filters -->
    <div class="mb-4">
      <label class="block text-sm text-gray-700 mb-1">From (date)</label>
      <input id="fromDate" type="date" class="border rounded p-2 w-full mb-2">

      <label class="block text-sm text-gray-700 mb-1">To (date)</label>
      <input id="toDate" type="date" class="border rounded p-2 w-full mb-2">

      <label class="block text-sm text-gray-700 mb-1">Limit</label>
      <input id="limit" type="number" min="1" max="50" value="10" class="border rounded p-2 w-full mb-2">

      <button onclick="loadEvents()" class="bg-blue-500 text-white px-3 py-1 rounded">Refresh Events</button>
    </div>

    <!-- Loading + Event list -->
    <div id="loading" class="text-gray-500 mb-2" style="display:none">Loadingâ€¦</div>
    <ul id="events" class="space-y-2"></ul>
  </div>

  <script>
    async function loadEvents() {
      setLoading(true);
      try {
        const from = document.getElementById('fromDate').value;
        const to = document.getElementById('toDate').value;
        const limit = document.getElementById('limit').value;

        const params = new URLSearchParams();
        if (from) params.append('from', new Date(from).toISOString());
        if (to) params.append('to', new Date(to).toISOString());
        if (limit) params.append('limit', limit);

        const res = await fetch(`/api/events?${params.toString()}&v=${Date.now()}`);
        const data = await res.json();
        renderEvents(data);
      } catch (err) {
        console.error(err);
      } finally {
        setLoading(false);
      }
    }

    function renderEvents(events) {
      const ul = document.getElementById('events');
      ul.innerHTML = '';

      if (!events || events.length === 0) {
        ul.innerHTML = `<li class="text-gray-500">No events found</li>`;
        return;
      }

      for (const ev of events) {
        const li = document.createElement('li');
        li.className = "border p-2 rounded flex justify-between items-center";
        li.innerHTML = `
          <span>${ev.title} (${new Date(ev.starts_at).toLocaleString()})</span>
          <button class="bg-red-500 text-white px-2 py-1 rounded" onclick="deleteEvent('${ev.id}')">Delete</button>
        `;
        ul.appendChild(li);
      }
    }

    async function deleteEvent(id) {
      if (!confirm("Are you sure you want to delete this event?")) return;
      await fetch(`/api/events/${id}`, { method: 'DELETE' });
      loadEvents();
    }

    function setLoading(on) {
      const el = document.getElementById('loading');
      if (el) el.style.display = on ? 'block' : 'none';
    }

    // Initial load
    loadEvents();
  </script>
</body>
</html>

