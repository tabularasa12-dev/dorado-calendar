<script>
  async function loadEvents(){
    const qs = buildQuery();
    const url = `${BASE}?${qs}`;
    // Show loading state
    eventsEl.innerHTML = '<li class="text-gray-500">Loading…</li>';

    try {
      const res = await fetch(url, { cache: 'no-store' });
      if (!res.ok) {
        eventsEl.innerHTML = '<li class="text-red-600">Failed to load events.</li>';
        return;
      }

      const data = await res.json();

      // Clear list
      eventsEl.innerHTML = '';

      // Robust empty-state check
      if (!Array.isArray(data) || data.length === 0) {
        eventsEl.innerHTML = `
          <li class="bg-white p-3 rounded border text-gray-600">
            No events found for the selected filters.
          </li>`;
        return;
      }

      // Render items
      for (const ev of data) {
        const li = document.createElement('li');
        li.className = "bg-white p-3 rounded shadow flex justify-between items-center";
        li.innerHTML = `
          <span>${ev.title} — ${new Date(ev.starts_at).toLocaleString()}</span>
          <button class="bg-red-600 text-white px-2 py-1 rounded"
            onclick="if (confirm('Are you sure you want to delete this event?')) deleteEvent('${ev.id}')">
            Delete
          </button>
        `;
        eventsEl.appendChild(li);
      }
    } catch (err) {
      console.error('loadEvents error:', err);
      eventsEl.innerHTML = '<li class="text-red-600">Network error. Please try again.</li>';
    }
  }
</script>

